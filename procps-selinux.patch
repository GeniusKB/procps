--- procps-3.1.8.orig/ps/ps.1
+++ procps-3.1.8/ps/ps.1
@@ -1,3 +1,5 @@
+'\" t
+.\" (The preceding line is a note to broken versions of man to tell
 .\" Man page for ps.
 .\" Quick hack conversion by Albert Cahalan, 1998.
 .\" Licensed under version 2 of the Gnu General Public License.
@@ -10,8 +12,8 @@
 .\" invented this crap in 1973. Oh yeah, they did. Sorry.
 .\"
 .TH PS 1 "July 5, 1998" "Linux" "Linux User's Manual"
-.SH \fRNAME\fR
-ps \- report process status
+.SH NAME
+ps \- report a snapshot of the current processes.
 .ad r
 .na
 .ss 12 0
@@ -19,17 +21,17 @@
 .nh
 .nf
 
-SYNOPSIS
+.SH SYNOPSIS
 ps [options]
 
 
-DESCRIPTION
+.SH DESCRIPTION
 ps gives a snapshot of the current processes. If you want
 a repetitive update of this status, use top. This man
 page documents the /proc-based version of ps, or tries to.
 
 
-COMMAND-LINE OPTIONS
+.SH "COMMAND-LINE OPTIONS"
 
 This version of ps accepts several kinds of options.
 
@@ -43,7 +45,9 @@
 when options are preceeded by a dash. The PS_PERSONALITY environment
 variable (described below) provides more detailed control of ps behavior.
 
-SIMPLE PROCESS SELECTION
+.SH "SIMPLE PROCESS SELECTION"
+.TS
+l l.
 -A           select all processes
 -N           negate selection
 -a           select all with a tty except session leaders
@@ -55,8 +59,11 @@
 r            restrict output to running processes
 x            select processes without controlling ttys
 --deselect   negate selection
+.TE
 
-PROCESS SELECTION BY LIST
+.SH "PROCESS SELECTION BY LIST"
+.TS
+l l.
 -C           select by command name
 -G           select by RGID (supports names)
 -U           select by RUID (supports names)
@@ -78,8 +85,10 @@
 --user       select by effective user name or ID
 -123         implied --sid
 123          implied --pid
-
-OUTPUT FORMAT CONTROL
+.TE
+.SH "OUTPUT FORMAT CONTROL"
+.TS
+l l.
 -O           is preloaded "-o"
 -F           extra full format
 -c           different scheduler info for -l option
@@ -99,8 +108,10 @@
 --format     user-defined format
 --context    (SELinux only) Display security context format; implies --secsid
 --secsid     (SELinux only) Display Security ID
-
-OUTPUT MODIFIERS
+.TE
+.SH "OUTPUT MODIFIERS"
+.TS
+l l.
 -H           show process hierarchy (forest)
 -m           show threads
 -n           set namelist file
@@ -126,24 +137,31 @@
 --rows       set screen height
 --sort       specify sorting order
 --width      set screen width
+.TE
 
-INFORMATION
+.SH INFORMATION
+
+.TS
+l l.
 -V          print version
 L           list all format specifiers
 V           show version info
 --help      print help message
 --info      print debugging info
 --version   print version
+.TE
+
+.SH OBSOLETE
 
-OBSOLETE
+.TS
+l l.
 A           increases the argument space (DecUnix)
 M           use alternate core (try -n or N instead)
 W           get swap info from ... not /dev/drum (try -n or N instead)
 k           use /vmcore as c-dumpfile (try -n or N instead)
+.TE
 
-
-
-NOTES
+.SH NOTES
 
 The "-g" option can select by session leader OR by group name.
 Selection by session leader is specified by many standards,
@@ -226,15 +244,19 @@
 will be destroyed by init(8) if the parent process exits.
 
 
-PROCESS FLAGS
-
+.SH "PROCESS FLAGS"
+.TS
+l l l.
 FORKNOEXEC   1    forked but didn't exec
 SUPERPRIV    2    used super-user privileges
 DUMPCORE     4    dumped core
+.TE
 
 
-PROCESS STATE CODES
+.SH "PROCESS STATE CODES"
 
+.TS
+l l.
 D uninterruptible sleep (usually IO)
 R runnable (on run queue)
 S sleeping
@@ -242,23 +264,30 @@
 W paging
 X dead
 Z a defunct ("zombie") process
+.TE
 
 For BSD formats and when the "stat" keyword is used, additional
 letters may be displayed:
 
-W has no resident pages
-< high-priority process
-N low-priority task
-L has pages locked into memory (for real-time and custom IO)
+.IP W
+has no resident pages
+.IP <
+high-priority process
+.IP N
+low-priority task
+.IP L
+has pages locked into memory (for real-time and custom IO)
 
 
-SORT KEYS
+.SH "SORT KEYS"
 
 Note that the values used in sorting are the internal values ps uses and not
 the `cooked' values used in some of the output format fields. Pipe ps
 output into the sort(1) command if you want to sort the cooked values.
 
-KEY LONG       DESCRIPTION
+.TS
+l l l.
+\fBKEY LONG       DESCRIPTION\fR
 c   cmd        simple name of executable
 C   cmdline    full command line
 f   flags      flags as in long format F field
@@ -285,14 +314,15 @@
 u   user       user name
 v   vsize      total VM size in kB
 y   priority   kernel scheduling priority
+.TE
 
-
-AIX FORMAT DESCRIPTORS
+.SH "AIX FORMAT DESCRIPTORS"
 
 This ps supports AIX format descriptors, which work somewhat like the
 formatting codes of printf(1) and printf(3). For example, the normal
 default output can be produced with this:   ps -eo "%p %y %x %c"
-
+.TS
+l l l.
 CODE  NORMAL    HEADER
 %C    pcpu      %CPU
 %G    group     GROUP
@@ -309,14 +339,16 @@
 %x    time      TIME
 %y    tty       TTY
 %z    vsz       VSZ
+.TE
 
-
-STANDARD FORMAT SPECIFIERS
+.SH "STANDARD FORMAT SPECIFIERS"
 
 These may be used to control both output format and sorting.
 For example:  ps -eo pid,user,args --sort user
 
-CODE         HEADER
+.TS
+l l.
+\fBCODE         HEADER\fR
 %cpu         %CPU    
 %mem         %MEM    
 alarm        ALARM   
@@ -438,25 +470,51 @@
 vsize        VSZ     
 vsz          VSZ     
 wchan        WCHAN   
+.TE
 
+.SH "ENVIRONMENT VARIABLES"
 
-
-
-ENVIRONMENT VARIABLES
 The following environment variables could affect ps:
-    COLUMNS             Override default display width.
-    LINES               Override default display height.
-    PS_PERSONALITY      Set to one of posix,old,linux,bsd,sun,digital...
-    CMD_ENV             Set to one of posix,old,linux,bsd,sun,digital...
-    I_WANT_A_BROKEN_PS  Force obsolete command line interpretation.
-    LC_TIME             Date format.
-    PS_COLORS           Not currently supported.
-    PS_FORMAT           Default output format override.
-    PS_SYSMAP           Default namelist (System.map) location.
-    PS_SYSTEM_MAP       Default namelist (System.map) location.
-    POSIXLY_CORRECT     Don't find excuses to ignore bad "features".
-    UNIX95              Don't find excuses to ignore bad "features".
-    _XPG                Cancel CMD_ENV=irix non-standard behavior.
+
+.TP 
+.B COLUMNS
+Override default display width.
+.TP
+.B LINES
+Override default display height.
+.TP
+.B PS_PERSONALITY
+Set to one of posix,old,linux,bsd,sun,digital...
+.TP
+.B CMD_ENV
+Set to one of posix,old,linux,bsd,sun,digital...
+.TP
+.B I_WANT_A_BROKEN_PS
+Force obsolete command line interpretation.
+.TP
+.B LC_TIME
+Date format.
+.TP
+.B PS_COLORS
+Not currently supported.
+.TP
+.B PS_FORMAT
+Default output format override.
+.TP
+.B PS_SYSMAP
+Default namelist (System.map) location.
+.TP
+.B PS_SYSTEM_MAP
+Default namelist (System.map) location.
+.TP
+.B POSIXLY_CORRECT
+Don't find excuses to ignore bad "features".
+.TP
+.B UNIX95
+Don't find excuses to ignore bad "features".
+.TP
+.B _XPG
+Cancel CMD_ENV=irix non-standard behavior.
 
 In general, it is a bad idea to set these variables. The one exception
 is CMD_ENV or PS_PERSONALITY, which could be set to Linux for normal
@@ -464,7 +522,9 @@
 of the Unix98 standard.
 
 
-PERSONALITY
+.SH "PERSONALITY"
+.TS
+l l.
     390      like the S/390 OpenEdition ps
     aix      like AIX ps
     bsd      like FreeBSD ps (totally non-standard)
@@ -486,9 +546,9 @@
     unix     standard
     unix95   standard
     unix98   standard
+.TE
 
-
-EXAMPLES
+.SH "EXAMPLES"
 To see every process on the system using standard syntax:
     ps -e
 To see every process on the system using BSD syntax:
@@ -502,13 +562,13 @@
 Print only the process IDs of syslogd:
     ps -C syslogd -o pid=
 
-SEE ALSO
-top(1) pgrep(1) pstree(1) proc(5)
+.SH "SEE ALSO"
+.BR top (1), pgrep (1), pstree (1),  proc (5).
 
-STANDARDS
+.SH STANDARDS
 This ps conforms to version 2 of the Single Unix Specification.
 
-AUTHOR
+.SH AUTHOR
 ps was originally written by Branko Lankester <lankeste@fwi.uva.nl>. Michael
 K. Johnson <johnsonm@redhat.com> re-wrote it significantly to use the proc
 filesystem, changing a few things in the process. Michael Shields
@@ -520,4 +580,4 @@
 <acahalan@cs.uml.edu> rewrote ps for full Unix98 and BSD support, along with
 some ugly hacks for obsolete and foreign syntax.
 
-Please send bug reports to <acahalan@cs.uml.edu>
+Please send bug reports to <procps-feedback@lists.sf.net>.
--- procps-3.1.8.orig/ps/module.mk
+++ procps-3.1.8/ps/module.mk
@@ -20,7 +20,7 @@
 TARFILES += $(PSSRC) $(addprefix ps/,$(PS_X))
 
 ps/ps: $(PSOBJ) $(LIBPROC)
-	$(CC) $(LDFLAGS) -o $@ $^
+	$(CC) $(LDFLAGS) -o $@ $^ $(SELIB)
 
 # This just adds the stacktrace code
 ps/debug: $(PSOBJ) stacktrace.o $(LIBPROC)
--- procps-3.1.8.orig/proc/readproc.c
+++ procps-3.1.8/proc/readproc.c
@@ -759,6 +759,8 @@
     else
 	PT = openproc(flags);
     va_end(ap);
+    if (!PT)
+      return 0;
     do {					/* read table: */
 	tab = xrealloc(tab, (n+1)*sizeof(proc_t*));/* realloc as we go, using */
 	tab[n] = readproc_direct(PT, NULL);     /* final null to terminate */
--- procps-3.1.8.orig/Makefile
+++ procps-3.1.8/Makefile
@@ -155,13 +155,13 @@
 ############ prog.o --> prog
 
 pmap w uptime tload free sysctl vmstat utmp pgrep skill: % : %.o $(LIBPROC)
-	$(CC) $(LDFLAGS) -o $@ $^
+	$(CC) $(LDFLAGS) -o $@ $^ $(SELIB)
 
 top:   % : %.o $(LIBPROC)
-	$(CC) $(LDFLAGS) -o $@ $^ $(CURSESLIB)
+	$(CC) $(LDFLAGS) -o $@ $^ $(CURSESLIB) $(SELIB)
 
 watch: % : %.o
-	$(CC) $(LDFLAGS) -o $@ $^ $(CURSESLIB)
+	$(CC) $(LDFLAGS) -o $@ $^ $(CURSESLIB) $(SELIB)
 
 ############ progX --> progY
 
--- procps-3.1.8.orig/skill.1
+++ procps-3.1.8/skill.1
@@ -8,7 +8,8 @@
 .\"
 .TH SKILL 1 "March 12, 1999" "Linux" "Linux User's Manual"
 .SH NAME
-skill, snice \- report process status
+skill \- Terminate or signal processes based on selection criteria
+snice \- Change processes priority based on selection criteria 
 
 .SH SYNOPSIS
 .nf
--- procps-3.1.8.orig/kill.1
+++ procps-3.1.8/kill.1
@@ -7,7 +7,7 @@
 .\" Michael K. Johnson
 .TH KILL 1 "November 21, 1999" "Linux" "Linux User's Manual"
 .SH NAME
-kill \- report process status
+kill \- Terminate or signal a process
 
 .SH SYNOPSIS
 .TS
